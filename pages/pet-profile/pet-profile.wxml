<!--pages/pet-profile/pet-profile.wxml-->
<view class="container">
  <view class="enroll-steps" wx:if="{{!isEdit}}">
    <view class="step-item active">
      <view class="step-num">1</view>
      <view class="step-text">基本资料</view>
    </view>
    <view class="step-line"></view>
    <view class="step-item">
      <view class="step-num">2</view>
      <view class="step-text">健康体征</view>
    </view>
  </view>

  <!-- 头像 -->
  <view class="avatar-section" bindtap="onChooseAvatar">
    <image
      class="avatar-image"
      src="{{form.avatar}}"
      mode="aspectFill"
      wx:if="{{form.avatar}}"
    />
    <view class="avatar-placeholder" wx:else>🐕</view>
    <view class="avatar-edit-hint">
      <text class="camera-icon">📷</text>
      <text>点击更换头像</text>
    </view>
  </view>

  <!-- 基本信息 -->
  <view class="section card">
    <view class="section-title">基本信息</view>

    <view class="form-group">
      <view class="form-label">TA 叫什么名字？ <text class="required">*</text></view>
      <input
        class="form-input"
        placeholder="给你的老宝贝取个名字"
        value="{{form.name}}"
        data-field="name"
        bindinput="onInputChange"
      />
    </view>

    <view class="form-group">
      <view class="form-label">犬种</view>
      <view class="form-picker" bindtap="showBreedSelector">
        <text class="breed-name-display {{form.breedName ? '' : 'placeholder'}}">{{form.breedName || '选择犬种'}}</text>
        <text class="picker-arrow">›</text>
      </view>
    </view>

    <view class="form-row">
      <view class="form-group half">
        <view class="form-label">年龄 <text class="required">*</text></view>
        <view class="input-with-unit">
          <input
            class="form-input"
            type="digit"
            placeholder="几岁了"
            value="{{form.age}}"
            data-field="age"
            bindinput="onInputChange"
          />
          <text class="unit">岁</text>
        </view>
      </view>

      <view class="form-group half">
        <view class="form-label">体重 <text class="required">*</text></view>
        <view class="input-with-unit">
          <input
            class="form-input"
            type="digit"
            placeholder="多重"
            value="{{form.weight}}"
            data-field="weight"
            bindinput="onInputChange"
          />
          <text class="unit">kg</text>
        </view>
      </view>
    </view>

    <view class="form-group">
      <view class="form-label">性别</view>
      <view class="gender-options">
        <view
          wx:for="{{genderOptions}}"
          wx:key="value"
          class="gender-option {{form.gender === item.value ? 'active' : ''}}"
          data-value="{{item.value}}"
          bindtap="onGenderChange"
        >
          {{item.label}}
        </view>
      </view>
    </view>

    <view class="form-group row">
      <view class="form-label">是否绝育</view>
      <view class="switch-wrap">
        <text class="switch-label {{!form.neutered ? 'active' : ''}}">No</text>
        <switch
          checked="{{form.neutered}}"
          bindchange="onNeuteredChange"
          color="#22d3ee"
        />
        <text class="switch-label {{form.neutered ? 'active' : ''}}">Yes</text>
      </view>
    </view>
  </view>

  <!-- 操作按钮 -->
  <view class="action-buttons">
    <button class="btn-primary" bindtap="onContinueHealth" wx:if="{{!isEdit}}">
      下一步：记录健康信息 →
    </button>
    <button class="btn-primary" bindtap="onSave" wx:else>保存修改</button>

    <button class="btn-secondary mt-20" bindtap="onSave" wx:if="{{!isEdit}}">
      仅保存基本资料
    </button>
    <button class="btn-delete mt-30" bindtap="onDelete" wx:if="{{isEdit}}">删除档案</button>
  </view>
</view>

<!-- 品种选择弹窗 -->
<view class="breed-picker-mask {{showBreedPicker ? 'show' : ''}}" bindtap="hideBreedSelector">
  <view class="breed-picker-content" catchtap="preventTap">
    <view class="picker-header">
      <text class="picker-title">选择犬种</text>
      <text class="picker-close" bindtap="hideBreedSelector">✕</text>
    </view>
    <view class="picker-search">
      <input
        class="search-input"
        placeholder="搜索犬种"
        value="{{breedSearchKey}}"
        bindinput="onBreedSearch"
      />
    </view>
    <scroll-view class="breed-list" scroll-y>
      <view
        class="breed-item {{form.breed === item.id ? 'selected' : ''}}"
        wx:for="{{filteredBreeds}}"
        wx:key="id"
        data-breed="{{item}}"
        bindtap="onSelectBreed"
      >
        <text class="breed-name">{{item.name}}</text>
        <text class="breed-size">{{item.size === 'small' ? '小型' : item.size === 'medium' ? '中型' : item.size === 'large' ? '大型' : '巨型'}}</text>
      </view>
      <view class="empty-tip" wx:if="{{filteredBreeds.length === 0}}">
        未找到匹配的犬种
      </view>
    </scroll-view>
  </view>
</view>
