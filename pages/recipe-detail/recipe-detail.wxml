<!--pages/recipe-detail/recipe-detail.wxml-->
<view class="container" wx:if="{{recipe}}">
  <!-- é£Ÿè°±å›¾ç‰‡ -->
  <view class="header-image-wrap">
    <image
      class="header-image"
      src="{{recipe.image}}"
      mode="aspectFill"
      wx:if="{{recipe.image}}"
    />
    <view class="header-image-placeholder" wx:else>ğŸ²</view>
  </view>

  <!-- åŸºæœ¬ä¿¡æ¯ -->
  <view class="info-section">
    <view class="recipe-title">{{recipe.name}}</view>
    <view class="recipe-desc">{{recipe.description}}</view>
    <view class="recipe-meta-row">
      <view class="meta-item">
        <text class="meta-icon">â±</text>
        <text>{{recipe.prepTime}}</text>
      </view>
      <view class="meta-item">
        <text class="meta-icon">ğŸ½</text>
        <text>{{recipe.servings}}</text>
      </view>
      <view class="meta-item">
        <text class="meta-icon">â­</text>
        <text>{{recipe.difficulty}}</text>
      </view>
    </view>
  </view>

  <!-- é€‚ç”¨å’Œç¦å¿Œ -->
  <view class="detail-section" wx:if="{{recipe.suitableNames.length > 0 || recipe.avoidNames.length > 0}}">
    <view wx:if="{{recipe.suitableNames.length > 0}}">
      <view class="section-label">é€‚ç”¨äº</view>
      <view class="tag-row">
        <view class="tag-green" wx:for="{{recipe.suitableNames}}" wx:key="*this">{{item}}</view>
      </view>
    </view>
  </view>

  <!-- é£Ÿææ¸…å• -->
  <view class="detail-section">
    <view class="section-title-with-icon">
      <text class="section-icon" style="color: #f97316;">ğŸ³</text>
      <text class="section-title">é£Ÿææ¸…å•</text>
    </view>
    <view class="ingredient-list">
      <view class="ingredient-item" wx:for="{{recipe.ingredients}}" wx:key="name">
        <text class="ingredient-name">{{item.name}}</text>
        <view class="ingredient-right">
          <view class="ingredient-amount">{{item.amount}}</view>
          <view class="ingredient-note" wx:if="{{item.note}}">{{item.note}}</view>
        </view>
      </view>
    </view>
    <view class="servings-note" wx:if="{{currentPet && currentPet.weight}}">
      å·²æ ¹æ® {{currentPet.name}} çš„ä½“é‡ ({{currentPet.weight}}kg) è‡ªåŠ¨è°ƒæ•´æ¯”ä¾‹ã€‚
    </view>
  </view>

  <!-- åˆ¶ä½œæ­¥éª¤ -->
  <view class="detail-section">
    <view class="section-title">åˆ¶ä½œæ­¥éª¤</view>
    <view class="step-list">
      <view class="step-item" wx:for="{{recipe.steps}}" wx:key="*this">
        <view class="step-number">{{index + 1}}</view>
        <view class="step-text">{{item}}</view>
      </view>
    </view>
  </view>

  <!-- è¥å…»ä¿¡æ¯ -->
  <view class="detail-section">
    <view class="section-title">è¥å…»ä¿¡æ¯</view>
    <view class="nutrition-grid">
      <view class="nutrition-item blue">
        <view class="nutrition-label">çƒ­é‡</view>
        <view class="nutrition-value">{{recipe.calories || '-'}}</view>
      </view>
      <view class="nutrition-item green">
        <view class="nutrition-label">è›‹ç™½è´¨</view>
        <view class="nutrition-value">{{recipe.nutrition.protein}}</view>
      </view>
      <view class="nutrition-item orange">
        <view class="nutrition-label">è„‚è‚ª</view>
        <view class="nutrition-value">{{recipe.nutrition.fat}}</view>
      </view>
      <view class="nutrition-item purple">
        <view class="nutrition-label">çº¤ç»´ç´ </view>
        <view class="nutrition-value">{{recipe.nutrition.fiber || '-'}}</view>
      </view>
    </view>
  </view>

  <!-- æ¸©é¦¨æç¤º -->
  <view class="detail-section" wx:if="{{recipe.tips.length > 0}}">
    <view class="section-title">æ¸©é¦¨æç¤º</view>
    <view class="tips-list">
      <view class="tip-item" wx:for="{{recipe.tips}}" wx:key="*this">
        <view class="tip-dot"></view>
        <text class="tip-text">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- æ³¨æ„äº‹é¡¹ -->
  <view class="detail-section" wx:if="{{recipe.warnings.length > 0}}">
    <view class="section-title warning">æ³¨æ„äº‹é¡¹</view>
    <view class="tips-list">
      <view class="tip-item" wx:for="{{recipe.warnings}}" wx:key="*this">
        <view class="tip-dot warning"></view>
        <text class="tip-text warning">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-bar">
    <button class="action-btn collect-btn {{isFavorited ? 'collected' : ''}}" bindtap="onCollect">
      <text>{{isFavorited ? 'â¤ï¸ å·²æ”¶è—' : 'ğŸ¤ æ”¶è—'}}</text>
    </button>
    <button class="action-btn share-btn" open-type="share">
      <text>â†—ï¸ åˆ†äº«</text>
    </button>
  </view>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-state" wx:if="{{!recipe}}">
  <text>æ•°æ®åŠ è½½ä¸­...</text>
</view>
