<!--pages/recipe-list/recipe-list.wxml-->
<view class="container">
  <!-- å½“å‰å® ç‰©æç¤º -->
  <view class="pet-banner" wx:if="{{currentPet}}" bindtap="onChangePet">
    <view class="pet-mini-avatar-wrap">
      <image class="pet-mini-avatar" src="{{currentPet.avatar}}" mode="aspectFill" wx:if="{{currentPet.avatar}}"/>
      <view class="pet-mini-avatar-placeholder" wx:else>ğŸ•</view>
    </view>
    <view class="pet-banner-info">
      <text class="pet-banner-name">{{currentPet.name}}</text>
      <text class="pet-banner-hint"> çš„ä¸“å±é£Ÿè°±</text>
    </view>
    <text class="change-pet">åˆ‡æ¢ â€º</text>
  </view>
  <view class="pet-banner empty" wx:else bindtap="onChangePet">
    <text>é€‰æ‹©ä½ çš„å®è´ï¼Œè·å–ä¸ªæ€§åŒ–é£Ÿè°±æ¨è</text>
    <text class="change-pet">å»é€‰æ‹© â€º</text>
  </view>

  <!-- æœç´¢å’Œç­›é€‰ -->
  <view class="search-bar">
    <view class="search-input-wrap">
      <text class="search-icon">ğŸ”</text>
      <input
        class="search-input"
        placeholder="æœç´¢é£Ÿè°±"
        value="{{searchKey}}"
        bindinput="onSearch"
      />
    </view>
    <view class="filter-btn {{filterDisease ? 'active' : ''}}" bindtap="toggleFilter">
      ç­›é€‰
    </view>
  </view>

  <!-- ç­›é€‰æ ‡ç­¾ -->
  <view class="active-filter" wx:if="{{filterDisease}}">
    <text>å½“å‰ç­›é€‰ï¼š</text>
    <view class="filter-tag">
      {{filterDiseaseName}}
      <text class="tag-close" catchtap="clearFilter">âœ•</text>
    </view>
  </view>

  <!-- é£Ÿè°±åˆ—è¡¨ -->
  <view class="recipe-list">
    <view
      class="recipe-card"
      wx:for="{{recipes}}"
      wx:key="id"
      data-id="{{item.id}}"
      bindtap="onRecipeTap"
    >
      <view class="recipe-image-wrap">
        <image
          class="recipe-image"
          src="{{item.image}}"
          mode="aspectFill"
          wx:if="{{item.image}}"
        />
        <view class="recipe-image-placeholder" wx:else>âš¡</view>
      </view>
      <view class="recipe-info">
        <view class="recipe-name">{{item.name}}</view>
        <view class="recipe-desc">{{item.description}}</view>
        <view class="recipe-meta">
          <text class="meta-item">â± {{item.prepTime}}</text>
          <text class="meta-item">ğŸ“Š {{item.difficulty}}</text>
        </view>
        <!-- åŒ¹é…æ ‡ç­¾ -->
        <view class="match-tags" wx:if="{{item.matchedDiseases && item.matchedDiseases.length > 0}}">
          <view class="match-tag" wx:for="{{item.matchedDiseases}}" wx:for-item="disease" wx:key="*this">
            é€‚åˆ{{disease}}
          </view>
        </view>
      </view>
      <view class="recipe-arrow">â€º</view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{recipes.length === 0}}">
      <view class="empty-text">æœªæ‰¾åˆ°åŒ¹é…çš„é£Ÿè°±</view>
      <button class="btn-secondary" bindtap="clearFilter">æ¸…é™¤ç­›é€‰</button>
    </view>
  </view>
</view>

<!-- ç­›é€‰å¼¹çª— -->
<view class="filter-mask {{showFilter ? 'show' : ''}}" bindtap="toggleFilter">
  <view class="filter-panel" catchtap="preventTap">
    <view class="filter-header">
      <text class="filter-title">æŒ‰ä½“å¾ç­›é€‰</text>
      <text class="filter-close" bindtap="toggleFilter">âœ•</text>
    </view>
    <scroll-view class="filter-content" scroll-y>
      <view
        class="filter-item {{filterDisease === item.id ? 'active' : ''}}"
        wx:for="{{diseases}}"
        wx:key="id"
        data-id="{{item.id}}"
        bindtap="onFilterByDisease"
      >
        <text>{{item.name}}</text>
        <text class="filter-check" wx:if="{{filterDisease === item.id}}">âœ“</text>
      </view>
    </scroll-view>
    <view class="filter-footer">
      <button class="btn-secondary" bindtap="clearFilter">æ¸…é™¤ç­›é€‰</button>
    </view>
  </view>
</view>
